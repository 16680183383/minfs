2025-08-19 00:00:44 [http-nio-8000-exec-4] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/psh/1/1, offset=0, length=128
2025-08-19 00:00:44 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /psh/1/1
2025-08-19 00:00:44 [http-nio-8000-exec-4] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh/1
2025-08-19 00:00:44 [http-nio-8000-exec-4] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh
2025-08-19 00:00:44 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh, 类型: Directory
2025-08-19 00:00:44 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1, 类型: Directory
2025-08-19 00:00:44 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 创建空文件成功: /psh/1/1, 副本位置: [localhost:9003, localhost:9002, localhost:9000]
2025-08-19 00:00:44 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1/1, 类型: File
2025-08-19 00:00:44 [http-nio-8000-exec-4] ERROR c.k.c.m.services.MetaService - 写入文件失败: /psh/1/1
java.lang.UnsupportedOperationException: null
	at java.base/java.util.ImmutableCollections.uoe(ImmutableCollections.java:142)
	at java.base/java.util.ImmutableCollections$AbstractImmutableList.sort(ImmutableCollections.java:261)
	at com.ksyun.campus.metaserver.services.MetaService.writeFile(MetaService.java:119)
	at com.ksyun.campus.metaserver.controller.MetaController.writeFile(MetaController.java:178)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-08-19 00:00:44 [http-nio-8000-exec-4] ERROR c.k.c.m.controller.MetaController - 写入文件失败: path=/psh/1/1
java.lang.RuntimeException: 写入文件失败: null
	at com.ksyun.campus.metaserver.services.MetaService.writeFile(MetaService.java:162)
	at com.ksyun.campus.metaserver.controller.MetaController.writeFile(MetaController.java:178)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: java.lang.UnsupportedOperationException: null
	at java.base/java.util.ImmutableCollections.uoe(ImmutableCollections.java:142)
	at java.base/java.util.ImmutableCollections$AbstractImmutableList.sort(ImmutableCollections.java:261)
	at com.ksyun.campus.metaserver.services.MetaService.writeFile(MetaService.java:119)
	... 51 common frames omitted
2025-08-19 00:01:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:01:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 3 个
2025-08-19 00:01:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9003 -> /psh/1/1，将从元数据中剔除
2025-08-19 00:01:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9002 -> /psh/1/1，将从元数据中剔除
2025-08-19 00:01:40 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9000 -> /psh/1/1，将从元数据中剔除
2025-08-19 00:01:40 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:01:40 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=3, 孤儿文件数=0, 耗时=41ms
2025-08-19 00:03:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:03:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 3 个
2025-08-19 00:03:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:03:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:03:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=3, 孤儿文件数=1, 耗时=5ms
2025-08-19 00:05:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:05:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 3 个
2025-08-19 00:05:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:05:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:05:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=3, 孤儿文件数=1, 耗时=1ms
2025-08-19 00:07:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:07:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 3 个
2025-08-19 00:07:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:07:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:07:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=3, 孤儿文件数=1, 耗时=0ms
2025-08-19 00:09:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:09:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 3 个
2025-08-19 00:09:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:09:39 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:09:39 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=3, 孤儿文件数=1, 耗时=0ms
2025-08-19 00:09:59 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-08-19 00:10:00 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-08-19 00:10:00 [SpringApplicationShutdownHook] INFO  c.k.c.m.s.MetadataStorageService - RocksDB已关闭
2025-08-19 00:10:00 [main-EventThread] WARN  c.k.c.m.services.ZkMetaServerService - Leader节点被删除，重新启动leader选举
2025-08-19 00:10:00 [SpringApplicationShutdownHook] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService销毁完成
2025-08-19 00:10:00 [main-EventThread] ERROR c.k.c.m.services.ZkMetaServerService - 尝试成为leader失败
org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /minfs/leader/leader
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:134)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
	at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1347)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService.tryBecomeLeader(ZkMetaServerService.java:142)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService$3.process(ZkMetaServerService.java:188)
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:579)
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:554)
2025-08-19 00:10:54 [main] INFO  c.k.c.m.MetaServerApplication - Starting MetaServerApplication using Java 17.0.15 with PID 143924 (D:\aaajava\minfs\metaServer\target\classes started by psh in D:\aaajava\minfs)
2025-08-19 00:10:54 [main] INFO  c.k.c.m.MetaServerApplication - The following 1 profile is active: "8000"
2025-08-19 00:10:55 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8000 (http)
2025-08-19 00:10:55 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-08-19 00:10:55 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.43]
2025-08-19 00:10:55 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-08-19 00:10:55 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 881 ms
2025-08-19 00:10:55 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功连接到Zookeeper: localhost:2181
2025-08-19 00:10:55 [main] INFO  c.k.c.m.services.ZkMetaServerService - 创建MetaServer节点: /minfs/metaservers/meta8000 -> localhost:8000:active:1755533455404
2025-08-19 00:10:55 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功成为leader: /minfs/leader/leader -> localhost:8000:1755533455419
2025-08-19 00:10:55 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService初始化完成
2025-08-19 00:10:55 [main] INFO  c.k.c.m.s.MetadataStorageService - 初始化RocksDB，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:10:56 [main] INFO  c.k.c.m.s.MetadataStorageService - RocksDB初始化成功，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:10:56 [main] INFO  c.k.c.m.s.MetadataStorageService - 路径缓存重建完成，共 3 条路径
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkDataServerService - ZK数据服务器服务成功连接到Zookeeper: localhost:2181
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9003 -> {"rack":"rack-04","port":9003,"zone":"az-014","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 4 个数据服务器
2025-08-19 00:10:56 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8000 (http) with context path '/'
2025-08-19 00:10:56 [main] INFO  c.k.c.m.MetaServerApplication - Started MetaServerApplication in 3.015 seconds (process running for 3.692)
2025-08-19 00:10:56 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService启动完成，当前节点: /minfs/metaservers/meta8000
2025-08-19 00:10:56 [main] INFO  c.k.c.m.bootstrap.StartupSyncRunner - 启动后检查并尝试从Leader追赶快照...
2025-08-19 00:10:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:10:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 3 个
2025-08-19 00:10:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:10:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:10:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=3, 孤儿文件数=1, 耗时=27ms
2025-08-19 00:11:00 [http-nio-8000-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-08-19 00:11:00 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-08-19 00:11:00 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-08-19 00:11:21 [http-nio-8000-exec-4] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/psh/1/2, offset=0, length=128
2025-08-19 00:11:21 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /psh/1/2
2025-08-19 00:11:21 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1/2, 类型: File
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.MetaService - 写入文件成功: /psh/1/2, 大小: 128, 副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:11:22 [http-nio-8000-exec-4] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:12:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:12:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 4 个
2025-08-19 00:12:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:12:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:12:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9003 -> /psh/1/2，将从元数据中剔除
2025-08-19 00:12:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9002 -> /psh/1/2，将从元数据中剔除
2025-08-19 00:12:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9001 -> /psh/1/2，将从元数据中剔除
2025-08-19 00:12:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/2
2025-08-19 00:12:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=4, 孤儿文件数=1, 耗时=60ms
2025-08-19 00:13:12 [http-nio-8000-exec-10] INFO  c.k.c.m.controller.MetaController - 创建文件: path=/test
2025-08-19 00:13:12 [http-nio-8000-exec-10] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /test, 类型: File
2025-08-19 00:13:12 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:13:12 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:14:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:14:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 5 个
2025-08-19 00:14:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:14:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:14:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/2, 缺少副本信息
2025-08-19 00:14:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/2
2025-08-19 00:14:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:14:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:14:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=5, 孤儿文件数=3, 耗时=6ms
2025-08-19 00:16:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:16:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 5 个
2025-08-19 00:16:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:16:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:16:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/2, 缺少副本信息
2025-08-19 00:16:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/2
2025-08-19 00:16:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:16:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:16:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=5, 孤儿文件数=3, 耗时=4ms
2025-08-19 00:18:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:18:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 5 个
2025-08-19 00:18:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/1, 缺少副本信息
2025-08-19 00:18:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/1
2025-08-19 00:18:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /psh/1/2, 缺少副本信息
2025-08-19 00:18:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /psh/1/2
2025-08-19 00:18:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:18:56 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:18:56 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=5, 孤儿文件数=3, 耗时=3ms
2025-08-19 00:19:33 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-08-19 00:19:34 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-08-19 00:19:34 [SpringApplicationShutdownHook] INFO  c.k.c.m.s.MetadataStorageService - RocksDB已关闭
2025-08-19 00:19:34 [main-EventThread] WARN  c.k.c.m.services.ZkMetaServerService - Leader节点被删除，重新启动leader选举
2025-08-19 00:19:34 [SpringApplicationShutdownHook] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService销毁完成
2025-08-19 00:19:34 [main-EventThread] ERROR c.k.c.m.services.ZkMetaServerService - 尝试成为leader失败
org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /minfs/leader/leader
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:134)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
	at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1347)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService.tryBecomeLeader(ZkMetaServerService.java:142)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService$3.process(ZkMetaServerService.java:188)
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:579)
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:554)
2025-08-19 00:20:40 [main] INFO  c.k.c.m.MetaServerApplication - Starting MetaServerApplication using Java 17.0.15 with PID 132276 (D:\aaajava\minfs\metaServer\target\classes started by psh in D:\aaajava\minfs)
2025-08-19 00:20:40 [main] INFO  c.k.c.m.MetaServerApplication - The following 1 profile is active: "8000"
2025-08-19 00:20:41 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8000 (http)
2025-08-19 00:20:41 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-08-19 00:20:41 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.43]
2025-08-19 00:20:41 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-08-19 00:20:41 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 930 ms
2025-08-19 00:20:41 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功连接到Zookeeper: localhost:2181
2025-08-19 00:20:41 [main] INFO  c.k.c.m.services.ZkMetaServerService - 创建MetaServer节点: /minfs/metaservers/meta8000 -> localhost:8000:active:1755534041695
2025-08-19 00:20:41 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功成为leader: /minfs/leader/leader -> localhost:8000:1755534041713
2025-08-19 00:20:41 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService初始化完成
2025-08-19 00:20:41 [main] INFO  c.k.c.m.s.MetadataStorageService - 初始化RocksDB，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:20:41 [main] INFO  c.k.c.m.s.MetadataStorageService - 创建RocksDB目录: ./data/metaserver-8000/rocksdb
2025-08-19 00:20:42 [main] INFO  c.k.c.m.s.MetadataStorageService - RocksDB初始化成功，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:20:42 [main] INFO  c.k.c.m.s.MetadataStorageService - 路径缓存重建完成，共 0 条路径
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkDataServerService - ZK数据服务器服务成功连接到Zookeeper: localhost:2181
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9003 -> {"rack":"rack-04","port":9003,"zone":"az-014","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 4 个数据服务器
2025-08-19 00:20:42 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8000 (http) with context path '/'
2025-08-19 00:20:42 [main] INFO  c.k.c.m.MetaServerApplication - Started MetaServerApplication in 2.873 seconds (process running for 3.527)
2025-08-19 00:20:42 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService启动完成，当前节点: /minfs/metaservers/meta8000
2025-08-19 00:20:42 [main] INFO  c.k.c.m.bootstrap.StartupSyncRunner - 启动后检查并尝试从Leader追赶快照...
2025-08-19 00:20:42 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:20:42 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 0 个
2025-08-19 00:20:42 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=0, 孤儿文件数=0, 耗时=0ms
2025-08-19 00:20:47 [http-nio-8000-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-08-19 00:20:47 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-08-19 00:20:47 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/psh/1/2, offset=0, length=128
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh/1
2025-08-19 00:22:07 [http-nio-8000-exec-7] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh, 类型: Directory
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1, 类型: Directory
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9003 -> /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9003 -> /psh/1/2, 返回: {success=true, replicaLocations=[localhost:9003], message=Create empty file success}
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9003 创建空文件成功: /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9002 -> /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9002 -> /psh/1/2, 返回: {success=true, replicaLocations=[localhost:9002], message=Create empty file success}
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9002 创建空文件成功: /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9001 -> /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9001 -> /psh/1/2, 返回: {success=true, replicaLocations=[localhost:9001], message=Create empty file success}
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9001 创建空文件成功: /psh/1/2
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件成功: /psh/1/2, 三副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1/2, 类型: File
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 使用已存在的副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:22:07 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 写入文件成功: /psh/1/2, 大小: 128, 副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:22:08 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.controller.MetaController - 创建文件: path=/test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9002 -> /test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9002 -> /test, 返回: {success=true, replicaLocations=[localhost:9002], message=Create empty file success}
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9002 创建空文件成功: /test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9001 -> /test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9001 -> /test, 返回: {success=true, replicaLocations=[localhost:9001], message=Create empty file success}
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9001 创建空文件成功: /test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9000 -> /test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9000 -> /test, 返回: {success=true, replicaLocations=[localhost:9000], message=Create empty file success}
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9000 创建空文件成功: /test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件成功: /test, 三副本位置: [localhost:9002, localhost:9001, localhost:9000]
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /test, 类型: File
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:22:20 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:22:42 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:22:42 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 4 个
2025-08-19 00:22:42 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9002 -> /test，将从元数据中剔除
2025-08-19 00:22:42 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9001 -> /test，将从元数据中剔除
2025-08-19 00:22:42 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9000 -> /test，将从元数据中剔除
2025-08-19 00:22:42 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:22:42 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=4, 孤儿文件数=0, 耗时=52ms
2025-08-19 00:24:33 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-08-19 00:24:33 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-08-19 00:24:33 [SpringApplicationShutdownHook] INFO  c.k.c.m.s.MetadataStorageService - RocksDB已关闭
2025-08-19 00:24:33 [main-EventThread] WARN  c.k.c.m.services.ZkMetaServerService - Leader节点被删除，重新启动leader选举
2025-08-19 00:24:33 [SpringApplicationShutdownHook] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService销毁完成
2025-08-19 00:24:33 [main-EventThread] ERROR c.k.c.m.services.ZkMetaServerService - 尝试成为leader失败
org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /minfs/leader/leader
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:134)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
	at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1347)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService.tryBecomeLeader(ZkMetaServerService.java:142)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService$3.process(ZkMetaServerService.java:188)
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:579)
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:554)
2025-08-19 00:25:04 [main] INFO  c.k.c.m.MetaServerApplication - Starting MetaServerApplication using Java 17.0.15 with PID 89752 (D:\aaajava\minfs\metaServer\target\classes started by psh in D:\aaajava\minfs)
2025-08-19 00:25:04 [main] INFO  c.k.c.m.MetaServerApplication - The following 1 profile is active: "8000"
2025-08-19 00:25:05 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8000 (http)
2025-08-19 00:25:05 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-08-19 00:25:05 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.43]
2025-08-19 00:25:05 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-08-19 00:25:05 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 916 ms
2025-08-19 00:25:05 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功连接到Zookeeper: localhost:2181
2025-08-19 00:25:05 [main] INFO  c.k.c.m.services.ZkMetaServerService - 创建MetaServer节点: /minfs/metaservers/meta8000 -> localhost:8000:active:1755534305687
2025-08-19 00:25:05 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功成为leader: /minfs/leader/leader -> localhost:8000:1755534305703
2025-08-19 00:25:05 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService初始化完成
2025-08-19 00:25:05 [main] INFO  c.k.c.m.s.MetadataStorageService - 初始化RocksDB，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:25:05 [main] INFO  c.k.c.m.s.MetadataStorageService - 创建RocksDB目录: ./data/metaserver-8000/rocksdb
2025-08-19 00:25:05 [main] INFO  c.k.c.m.s.MetadataStorageService - RocksDB初始化成功，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:25:05 [main] INFO  c.k.c.m.s.MetadataStorageService - 路径缓存重建完成，共 0 条路径
2025-08-19 00:25:05 [main] INFO  c.k.c.m.services.ZkDataServerService - ZK数据服务器服务成功连接到Zookeeper: localhost:2181
2025-08-19 00:25:06 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9003 -> {"rack":"rack-04","port":9003,"zone":"az-014","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:06 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:06 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:06 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:06 [main] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 4 个数据服务器
2025-08-19 00:25:06 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8000 (http) with context path '/'
2025-08-19 00:25:06 [main] INFO  c.k.c.m.MetaServerApplication - Started MetaServerApplication in 2.423 seconds (process running for 3.093)
2025-08-19 00:25:06 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:25:06 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 0 个
2025-08-19 00:25:06 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=0, 孤儿文件数=0, 耗时=0ms
2025-08-19 00:25:06 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService启动完成，当前节点: /minfs/metaservers/meta8000
2025-08-19 00:25:06 [main] INFO  c.k.c.m.bootstrap.StartupSyncRunner - 启动后检查并尝试从Leader追赶快照...
2025-08-19 00:25:08 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:25:08 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9003 -> {"rack":"rack-04","port":9003,"zone":"az-014","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:08 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:08 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:08 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 3 个数据服务器
2025-08-19 00:25:10 [http-nio-8000-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-08-19 00:25:10 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-08-19 00:25:10 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-08-19 00:25:12 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:25:12 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:25:12 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 1 个数据服务器
2025-08-19 00:25:14 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:25:14 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 0 个数据服务器
2025-08-19 00:26:04 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:26:04 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:04 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 1 个数据服务器
2025-08-19 00:26:07 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:26:07 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:07 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:07 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 2 个数据服务器
2025-08-19 00:26:09 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:26:09 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:09 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:09 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:09 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 3 个数据服务器
2025-08-19 00:26:13 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 检测到数据服务器列表变化，重新加载...
2025-08-19 00:26:13 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9003 -> {"rack":"rack-04","port":9003,"zone":"az-014","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:13 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:13 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:13 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:26:13 [main-EventThread] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 4 个数据服务器
2025-08-19 00:26:26 [http-nio-8000-exec-6] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/psh/1/2, offset=0, length=128
2025-08-19 00:26:26 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /psh/1/2
2025-08-19 00:26:26 [http-nio-8000-exec-6] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh/1
2025-08-19 00:26:26 [http-nio-8000-exec-6] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh
2025-08-19 00:26:26 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh, 类型: Directory
2025-08-19 00:26:26 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1, 类型: Directory
2025-08-19 00:26:26 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9003 -> /psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9003 -> /psh/1/2, 返回: {success=true, replicaLocations=[localhost:9003], message=Create empty file success}
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9003 创建空文件成功: /psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9002 -> /psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9002 -> /psh/1/2, 返回: {success=true, replicaLocations=[localhost:9002], message=Create empty file success}
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9002 创建空文件成功: /psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9001 -> /psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9001 -> /psh/1/2, 返回: {success=true, replicaLocations=[localhost:9001], message=Create empty file success}
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9001 创建空文件成功: /psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件成功: /psh/1/2, 三副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1/2, 类型: File
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 使用已存在的副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 写入文件成功: /psh/1/2, 大小: 128, 副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:26:27 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.controller.MetaController - 创建文件: path=/test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9002 -> /test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9002 -> /test, 返回: {success=true, replicaLocations=[localhost:9002], message=Create empty file success}
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9002 创建空文件成功: /test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9001 -> /test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9001 -> /test, 返回: {success=true, replicaLocations=[localhost:9001], message=Create empty file success}
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9001 创建空文件成功: /test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - 调用DataServer创建空文件: localhost:9000 -> /test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.s.DataServerClientService - DataServer创建空文件成功: localhost:9000 -> /test, 返回: {success=true, replicaLocations=[localhost:9000], message=Create empty file success}
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 在DataServer localhost:9000 创建空文件成功: /test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件成功: /test, 三副本位置: [localhost:9002, localhost:9001, localhost:9000]
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /test, 类型: File
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:26:54 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:27:06 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:27:06 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 4 个
2025-08-19 00:27:06 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9002 -> /test，将从元数据中剔除
2025-08-19 00:27:06 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9001 -> /test，将从元数据中剔除
2025-08-19 00:27:06 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9000 -> /test，将从元数据中剔除
2025-08-19 00:27:06 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:27:06 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=4, 孤儿文件数=0, 耗时=46ms
2025-08-19 00:28:56 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-08-19 00:28:57 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-08-19 00:28:57 [SpringApplicationShutdownHook] INFO  c.k.c.m.s.MetadataStorageService - RocksDB已关闭
2025-08-19 00:28:57 [main-EventThread] WARN  c.k.c.m.services.ZkMetaServerService - Leader节点被删除，重新启动leader选举
2025-08-19 00:28:57 [main-EventThread] ERROR c.k.c.m.services.ZkMetaServerService - 尝试成为leader失败
org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /minfs/leader/leader
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:102)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
	at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1347)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService.tryBecomeLeader(ZkMetaServerService.java:142)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService$3.process(ZkMetaServerService.java:188)
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:579)
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:554)
2025-08-19 00:28:57 [SpringApplicationShutdownHook] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService销毁完成
2025-08-19 00:40:24 [main] INFO  c.k.c.m.MetaServerApplication - Starting MetaServerApplication using Java 17.0.15 with PID 93304 (D:\aaajava\minfs\metaServer\target\classes started by psh in D:\aaajava\minfs)
2025-08-19 00:40:24 [main] INFO  c.k.c.m.MetaServerApplication - The following 1 profile is active: "8000"
2025-08-19 00:40:25 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8000 (http)
2025-08-19 00:40:25 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-08-19 00:40:25 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.43]
2025-08-19 00:40:25 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-08-19 00:40:25 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1053 ms
2025-08-19 00:40:25 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功连接到Zookeeper: localhost:2181
2025-08-19 00:40:25 [main] INFO  c.k.c.m.services.ZkMetaServerService - 创建MetaServer节点: /minfs/metaservers/meta8000 -> localhost:8000:active:1755535225522
2025-08-19 00:40:25 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功成为leader: /minfs/leader/leader -> localhost:8000:1755535225545
2025-08-19 00:40:25 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService初始化完成
2025-08-19 00:40:25 [main] INFO  c.k.c.m.s.MetadataStorageService - 初始化RocksDB，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:40:25 [main] INFO  c.k.c.m.s.MetadataStorageService - 创建RocksDB目录: ./data/metaserver-8000/rocksdb
2025-08-19 00:40:26 [main] INFO  c.k.c.m.s.MetadataStorageService - RocksDB初始化成功，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:40:26 [main] INFO  c.k.c.m.s.MetadataStorageService - 路径缓存重建完成，共 0 条路径
2025-08-19 00:40:26 [main] INFO  c.k.c.m.services.ZkDataServerService - ZK数据服务器服务成功连接到Zookeeper: localhost:2181
2025-08-19 00:40:26 [main] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 0 个数据服务器
2025-08-19 00:40:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8000 (http) with context path '/'
2025-08-19 00:40:26 [main] INFO  c.k.c.m.MetaServerApplication - Started MetaServerApplication in 3.122 seconds (process running for 3.851)
2025-08-19 00:40:26 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:40:26 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 0 个
2025-08-19 00:40:26 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=0, 孤儿文件数=0, 耗时=0ms
2025-08-19 00:40:26 [main] INFO  c.k.c.m.bootstrap.StartupSyncRunner - 启动后检查并尝试从Leader追赶快照...
2025-08-19 00:40:26 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService启动完成，当前节点: /minfs/metaservers/meta8000
2025-08-19 00:40:30 [http-nio-8000-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-08-19 00:40:30 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-08-19 00:40:30 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-08-19 00:41:57 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-08-19 00:41:58 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-08-19 00:41:58 [SpringApplicationShutdownHook] INFO  c.k.c.m.s.MetadataStorageService - RocksDB已关闭
2025-08-19 00:41:58 [main-EventThread] WARN  c.k.c.m.services.ZkMetaServerService - Leader节点被删除，重新启动leader选举
2025-08-19 00:41:58 [SpringApplicationShutdownHook] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService销毁完成
2025-08-19 00:41:58 [main-EventThread] ERROR c.k.c.m.services.ZkMetaServerService - 尝试成为leader失败
org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /minfs/leader/leader
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:134)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
	at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:1347)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService.tryBecomeLeader(ZkMetaServerService.java:142)
	at com.ksyun.campus.metaserver.services.ZkMetaServerService$3.process(ZkMetaServerService.java:188)
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:579)
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:554)
2025-08-19 00:44:46 [main] INFO  c.k.c.m.MetaServerApplication - Starting MetaServerApplication using Java 17.0.15 with PID 133808 (D:\aaajava\minfs\metaServer\target\classes started by psh in D:\aaajava\minfs)
2025-08-19 00:44:46 [main] INFO  c.k.c.m.MetaServerApplication - The following 1 profile is active: "8000"
2025-08-19 00:44:47 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8000 (http)
2025-08-19 00:44:47 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-08-19 00:44:47 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.43]
2025-08-19 00:44:47 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-08-19 00:44:47 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1168 ms
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功连接到Zookeeper: localhost:2181
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkMetaServerService - 创建MetaServer节点: /minfs/metaservers/meta8000 -> localhost:8000:active:1755535488106
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkMetaServerService - 成功成为leader: /minfs/leader/leader -> localhost:8000:1755535488125
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService初始化完成
2025-08-19 00:44:48 [main] INFO  c.k.c.m.s.MetadataStorageService - 初始化RocksDB，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:44:48 [main] INFO  c.k.c.m.s.MetadataStorageService - RocksDB初始化成功，路径: ./data/metaserver-8000/rocksdb
2025-08-19 00:44:48 [main] INFO  c.k.c.m.s.MetadataStorageService - 路径缓存重建完成，共 0 条路径
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkDataServerService - ZK数据服务器服务成功连接到Zookeeper: localhost:2181
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9003 -> {"rack":"rack-04","port":9003,"zone":"az-014","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9002 -> {"rack":"rack-03","port":9002,"zone":"az-03","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9001 -> {"rack":"rack-02","port":9001,"zone":"az-02  ","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkDataServerService - 加载数据服务器: localhost:9000 -> {"rack":"rack-01","port":9000,"zone":"az-01","totalCapacity":102400,"usedCapacity":0,"ip":"localhost","status":"alive"}
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkDataServerService - 成功加载 4 个数据服务器
2025-08-19 00:44:48 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8000 (http) with context path '/'
2025-08-19 00:44:48 [main] INFO  c.k.c.m.MetaServerApplication - Started MetaServerApplication in 2.87 seconds (process running for 3.912)
2025-08-19 00:44:48 [main] INFO  c.k.c.m.bootstrap.StartupSyncRunner - 启动后检查并尝试从Leader追赶快照...
2025-08-19 00:44:48 [main] INFO  c.k.c.m.services.ZkMetaServerService - ZkMetaServerService启动完成，当前节点: /minfs/metaservers/meta8000
2025-08-19 00:44:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:44:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 0 个
2025-08-19 00:44:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=0, 孤儿文件数=0, 耗时=0ms
2025-08-19 00:44:49 [http-nio-8000-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-08-19 00:44:49 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-08-19 00:44:49 [http-nio-8000-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-08-19 00:46:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:46:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 0 个
2025-08-19 00:46:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=0, 孤儿文件数=0, 耗时=0ms
2025-08-19 00:48:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:48:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 0 个
2025-08-19 00:48:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=0, 孤儿文件数=0, 耗时=0ms
2025-08-19 00:49:42 [http-nio-8000-exec-6] INFO  c.k.c.m.controller.MetaController - 创建文件: path=/test
2025-08-19 00:49:42 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件成功: /test, 选择的三副本位置: [localhost:9003, localhost:9002, localhost:9001]
2025-08-19 00:49:42 [http-nio-8000-exec-6] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /test, 类型: File
2025-08-19 00:49:42 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:49:42 [http-nio-8000-exec-6] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/test
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/psh/1/2, offset=0, length=128
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /psh/1/2
2025-08-19 00:49:54 [http-nio-8000-exec-8] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh/1
2025-08-19 00:49:54 [http-nio-8000-exec-8] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /psh
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh, 类型: Directory
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1, 类型: Directory
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 创建文件成功: /psh/1/2, 选择的三副本位置: [localhost:9002, localhost:9001, localhost:9000]
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/1/2, 类型: File
2025-08-19 00:49:54 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 使用已存在的副本位置: [localhost:9002, localhost:9001, localhost:9000]
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 写入文件成功: /psh/1/2, 大小: 128, 副本位置: [localhost:9002, localhost:9001, localhost:9000]
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/1
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/psh/1/2
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:49:55 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 WRITE 成功, path=/psh/1/2
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/test/1/2, offset=0, length=128
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /test/1/2
2025-08-19 00:50:06 [http-nio-8000-exec-7] WARN  c.k.c.m.services.MetaService - 父目录不存在，先创建父目录: /test/1
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /test/1, 类型: Directory
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件成功: /test/1/2, 选择的三副本位置: [localhost:9001, localhost:9000, localhost:9003]
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /test/1/2, 类型: File
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 使用已存在的副本位置: [localhost:9001, localhost:9000, localhost:9003]
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.MetaService - 写入文件成功: /test/1/2, 大小: 128, 副本位置: [localhost:9001, localhost:9000, localhost:9003]
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/test
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/test
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/test/1
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/test/1
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/test/1/2
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/test/1/2
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 WRITE 成功, path=/test/1/2
2025-08-19 00:50:06 [http-nio-8000-exec-7] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 WRITE 成功, path=/test/1/2
2025-08-19 00:50:45 [http-nio-8000-exec-9] INFO  c.k.c.m.controller.MetaController - 创建目录: path=/psh/2
2025-08-19 00:50:45 [http-nio-8000-exec-9] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/2, 类型: Directory
2025-08-19 00:50:45 [http-nio-8000-exec-9] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:50:45 [http-nio-8000-exec-9] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:50:45 [http-nio-8000-exec-9] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/2
2025-08-19 00:50:45 [http-nio-8000-exec-9] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/2
2025-08-19 00:50:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:50:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 7 个
2025-08-19 00:50:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9003 -> /test，将从元数据中剔除
2025-08-19 00:50:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9002 -> /test，将从元数据中剔除
2025-08-19 00:50:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9001 -> /test，将从元数据中剔除
2025-08-19 00:50:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:50:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=7, 孤儿文件数=0, 耗时=50ms
2025-08-19 00:50:56 [http-nio-8000-exec-10] INFO  c.k.c.m.controller.MetaController - 列出目录内容: path=/psh
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.controller.MetaController - 创建目录: path=/psh/2/1
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/2/1, 类型: Directory
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/2
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/2
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/2/1
2025-08-19 00:51:05 [http-nio-8000-exec-1] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/2/1
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.controller.MetaController - 创建目录: path=/psh/2/2
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/2/2, 类型: Directory
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/2
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/2
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh/2/2
2025-08-19 00:51:09 [http-nio-8000-exec-2] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh/2/2
2025-08-19 00:51:11 [http-nio-8000-exec-3] INFO  c.k.c.m.controller.MetaController - 列出目录内容: path=/psh
2025-08-19 00:51:16 [http-nio-8000-exec-4] INFO  c.k.c.m.controller.MetaController - 列出目录内容: path=/psh
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.controller.MetaController - 删除文件/目录: path=/psh/1
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.MetaService - 开始递归删除目录: /psh/1
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.MetaService - 目录 /psh/1 包含 1 个子项，开始递归删除
2025-08-19 00:51:26 [pool-2-thread-1] INFO  c.k.c.m.s.DataServerClientService - 成功从DataServer删除: localhost:9002 -> /psh/1/2
2025-08-19 00:51:26 [pool-2-thread-2] INFO  c.k.c.m.s.DataServerClientService - 成功从DataServer删除: localhost:9001 -> /psh/1/2
2025-08-19 00:51:26 [pool-2-thread-3] INFO  c.k.c.m.s.DataServerClientService - 成功从DataServer删除: localhost:9000 -> /psh/1/2
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.s.DataServerClientService - 多副本删除完成: 3/3 成功
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.MetaService - 删除子文件: /psh/1/2, 在DataServer上成功删除: 3/3
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.MetaService - 目录 /psh/1 的所有子项删除完成
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.MetaService - 成功删除文件/目录: /psh/1
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 DELETE 成功, path=/psh/1
2025-08-19 00:51:26 [http-nio-8000-exec-5] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 DELETE 成功, path=/psh/1
2025-08-19 00:51:29 [http-nio-8000-exec-6] INFO  c.k.c.m.controller.MetaController - 列出目录内容: path=/psh
2025-08-19 00:52:00 [http-nio-8000-exec-8] INFO  c.k.c.m.controller.MetaController - 删除文件/目录: path=/test/1/2
2025-08-19 00:52:00 [pool-2-thread-4] INFO  c.k.c.m.s.DataServerClientService - 成功从DataServer删除: localhost:9001 -> /test/1/2
2025-08-19 00:52:00 [pool-2-thread-5] INFO  c.k.c.m.s.DataServerClientService - 成功从DataServer删除: localhost:9000 -> /test/1/2
2025-08-19 00:52:00 [pool-2-thread-6] INFO  c.k.c.m.s.DataServerClientService - 成功从DataServer删除: localhost:9003 -> /test/1/2
2025-08-19 00:52:00 [http-nio-8000-exec-8] INFO  c.k.c.m.s.DataServerClientService - 多副本删除完成: 3/3 成功
2025-08-19 00:52:00 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 删除文件: /test/1/2, 在DataServer上成功删除: 3/3
2025-08-19 00:52:00 [http-nio-8000-exec-8] INFO  c.k.c.m.services.MetaService - 成功删除文件/目录: /test/1/2
2025-08-19 00:52:00 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 DELETE 成功, path=/test/1/2
2025-08-19 00:52:00 [http-nio-8000-exec-8] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 DELETE 成功, path=/test/1/2
2025-08-19 00:52:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:52:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 6 个
2025-08-19 00:52:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:52:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:52:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=6, 孤儿文件数=1, 耗时=1ms
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.controller.MetaController - 写入文件: path=/psh/test, offset=0, length=128
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.MetaService - 文件不存在，先创建文件: /psh/test
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.MetaService - 创建文件成功: /psh/test, 选择的三副本位置: [localhost:9000, localhost:9003, localhost:9002]
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.MetaService - 创建文件/目录: /psh/test, 类型: File
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.MetaService - 使用已存在的副本位置: [localhost:9000, localhost:9003, localhost:9002]
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.MetaService - 写入文件成功: /psh/test, 大小: 128, 副本位置: [localhost:9000, localhost:9003, localhost:9002]
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_DIR 成功, path=/psh
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 CREATE_FILE 成功, path=/psh/test
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 CREATE_FILE 成功, path=/psh/test
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8001 复制 WRITE 成功, path=/psh/test
2025-08-19 00:54:11 [http-nio-8000-exec-10] INFO  c.k.c.m.services.ReplicationService - 向从节点 localhost:8002 复制 WRITE 成功, path=/psh/test
2025-08-19 00:54:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:54:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 7 个
2025-08-19 00:54:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:54:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:54:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 检测到失效副本: localhost:9002 -> /psh/test，将从元数据中剔除
2025-08-19 00:54:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 自愈复制成功: localhost:9000 -> localhost:9002 (/psh/test)
2025-08-19 00:54:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=7, 孤儿文件数=1, 耗时=50ms
2025-08-19 00:56:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:56:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 7 个
2025-08-19 00:56:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:56:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:56:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=7, 孤儿文件数=1, 耗时=37ms
2025-08-19 00:58:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 00:58:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 7 个
2025-08-19 00:58:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 00:58:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 00:58:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=7, 孤儿文件数=1, 耗时=40ms
2025-08-19 01:00:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 01:00:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 7 个
2025-08-19 01:00:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 01:00:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 01:00:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=7, 孤儿文件数=1, 耗时=40ms
2025-08-19 01:02:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始定时FSCK检查
2025-08-19 01:02:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - 开始检查所有文件，共 7 个
2025-08-19 01:02:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 发现孤儿文件: /test, 缺少副本信息
2025-08-19 01:02:48 [scheduling-1] WARN  c.k.c.m.services.FsckServices - 文件无可用源副本，无法自愈: /test
2025-08-19 01:02:48 [scheduling-1] INFO  c.k.c.m.services.FsckServices - FSCK检查完成: 总文件数=7, 孤儿文件数=1, 耗时=11ms
